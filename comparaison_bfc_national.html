<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparaison BFC/National - CGT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="auth.js"></script>
    <link rel="stylesheet" href="css/carte-bfc.css">
    <style>
        .comparison-card {
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .comparison-header {
            background-color: #e63946;
            color: white;
            padding: 15px;
            font-weight: 600;
        }
        
        .comparison-body {
            padding: 20px;
        }
        
        .comparison-table {
            width: 100%;
        }
        
        .comparison-table th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .comparison-table td {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .bfc-value {
            font-weight: 600;
            color: #e63946;
        }
        
        .national-value {
            font-weight: 600;
            color: #1d3557;
        }
        
        .diff-positive {
            color: #28a745;
        }
        
        .diff-negative {
            color: #dc3545;
        }
        
        .chart-container {
            height: 300px;
            margin-bottom: 30px;
        }
        
        .syndicat-icon {
            width: 20px;
            height: 20px;
            display: inline-block;
            margin-right: 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center">
                    <img src="logo-cgt.png" alt="Logo CGT" style="height: 60px; margin-right: 15px;">
                    Comparaison Bourgogne-Franche-Comté / National
                </h1>
                <div class="text-end">
                    <button id="logout-btn" class="btn btn-outline-danger" onclick="logout()">Déconnexion</button>
                </div>
                <script>
                    function logout() {
                        localStorage.removeItem('authenticated');
                        window.location.href = 'login.html';
                    }
                </script>
            </div>
        </div>
        
        <div class="alert alert-danger">
            <div class="row align-items-center">
                <div class="col-md-2 text-center">
                    <img src="logo-cgt.png" alt="Logo CGT" style="max-height: 60px;" class="img-fluid">
                </div>
                <div class="col-md-10">
                    <h4 class="mb-0">Analyse comparative des résultats électoraux</h4>
                    <p class="mb-0">Bourgogne-Franche-Comté vs National - Mesure de représentativité du 8 avril 2025</p>
                </div>
            </div>
        </div>
        
        <!-- Résumé des indicateurs clés -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="comparison-card">
                    <div class="comparison-header">
                        Indicateurs clés CGT
                    </div>
                    <div class="comparison-body">
                        <div class="row" id="key-indicators">
                            <!-- Les indicateurs clés seront injectés ici par JavaScript -->
                            <div class="col-md-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <h5>Pourcentage de voix</h5>
                                        <div class="d-flex justify-content-around align-items-center mt-3">
                                            <div>
                                                <div class="bfc-value fs-3">XX.XX%</div>
                                                <div>BFC</div>
                                            </div>
                                            <div class="fs-4">vs</div>
                                            <div>
                                                <div class="national-value fs-3">XX.XX%</div>
                                                <div>National</div>
                                            </div>
                                        </div>
                                        <div class="mt-2 diff-positive">
                                            <i class="bi bi-arrow-up"></i> +X.XX points
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <h5>Nombre de sièges</h5>
                                        <div class="d-flex justify-content-around align-items-center mt-3">
                                            <div>
                                                <div class="bfc-value fs-3">XXXX</div>
                                                <div>BFC</div>
                                            </div>
                                            <div class="fs-4">vs</div>
                                            <div>
                                                <div class="national-value fs-3">XXXXX</div>
                                                <div>National</div>
                                            </div>
                                        </div>
                                        <div class="mt-2 diff-positive">
                                            <i class="bi bi-arrow-up"></i> +XX.X%
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <h5>Implantation</h5>
                                        <div class="d-flex justify-content-around align-items-center mt-3">
                                            <div>
                                                <div class="bfc-value fs-3">XXX</div>
                                                <div>BFC</div>
                                            </div>
                                            <div class="fs-4">vs</div>
                                            <div>
                                                <div class="national-value fs-3">XXXX</div>
                                                <div>National</div>
                                            </div>
                                        </div>
                                        <div class="mt-2 diff-negative">
                                            <i class="bi bi-arrow-down"></i> -XX.X%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Graphiques de comparaison -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="comparison-card h-100">
                    <div class="comparison-header">
                        Pourcentage de voix par syndicat
                    </div>
                    <div class="comparison-body">
                        <div class="chart-container">
                            <canvas id="voix-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="comparison-card h-100">
                    <div class="comparison-header">
                        Répartition des sièges
                    </div>
                    <div class="comparison-body">
                        <div class="chart-container">
                            <canvas id="sieges-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tableau comparatif détaillé -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="comparison-card">
                    <div class="comparison-header">
                        Tableau comparatif détaillé
                    </div>
                    <div class="comparison-body">
                        <div class="table-responsive">
                            <table class="comparison-table" id="detailed-table">
                                <thead>
                                    <tr>
                                        <th>Syndicat</th>
                                        <th>Voix BFC</th>
                                        <th>% BFC</th>
                                        <th>Voix National</th>
                                        <th>% National</th>
                                        <th>Écart</th>
                                        <th>Sièges BFC</th>
                                        <th>Sièges National</th>
                                        <th>Implantation BFC</th>
                                        <th>Implantation National</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Les données seront injectées ici par JavaScript -->
                                    <tr>
                                        <td><span class="syndicat-icon" style="background-color: #e63946;"></span> CGT</td>
                                        <td>XXXXX</td>
                                        <td class="bfc-value">XX.XX%</td>
                                        <td>XXXXXX</td>
                                        <td class="national-value">XX.XX%</td>
                                        <td class="diff-positive">+X.XX</td>
                                        <td>XXXX</td>
                                        <td>XXXXX</td>
                                        <td>XXX</td>
                                        <td>XXXX</td>
                                    </tr>
                                    <tr>
                                        <td><span class="syndicat-icon" style="background-color: #457b9d;"></span> CFDT</td>
                                        <td>XXXXX</td>
                                        <td>XX.XX%</td>
                                        <td>XXXXXX</td>
                                        <td>XX.XX%</td>
                                        <td class="diff-negative">-X.XX</td>
                                        <td>XXXX</td>
                                        <td>XXXXX</td>
                                        <td>XXX</td>
                                        <td>XXXX</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Comparaison par département -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="comparison-card">
                    <div class="comparison-header">
                        Performance CGT par département de BFC
                    </div>
                    <div class="comparison-body">
                        <div class="chart-container">
                            <canvas id="departements-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4 mb-4">
            <div class="col-12 text-center">
                <a href="index_bfc.html" class="btn btn-outline-danger">
                    <i class="bi bi-arrow-left"></i> Retour à l'accueil
                </a>
                <a href="carte_bfc.html" class="btn btn-outline-danger">
                    <i class="bi bi-map"></i> Carte interactive
                </a>
                <a href="departements_bfc.html" class="btn btn-outline-danger">
                    <i class="bi bi-table"></i> Détails par département
                </a>
            </div>
        </div>
    </div>
    
    <!-- Script de traitement des données -->
    <script src="js/process-data-bfc.js"></script>
    
    <!-- Script pour la comparaison -->
    <!-- Nouveau script de chargement de données -->
    <script src="js/bfc-data-loader.js"></script>
    <script>
        // Initialisation de la page de comparaison
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initialisation de la page de comparaison BFC/National');
            
            // Charger les données pour tous les départements
            BFCDataLoader.loadAllBFCData().then(() => {
                // Mettre à jour les indicateurs clés
                updateKeyIndicators();
                
                // Créer les graphiques
                createCharts();
            });
        });
        
        // Fonction pour mettre à jour les indicateurs clés
        function updateKeyIndicators() {
            console.log('Mise à jour des indicateurs clés');
            
            // Données nationales fictives pour la démonstration
            const nationalData = {
                voix: {
                    CGT: 1250000,
                    CGT_pourcentage: 23.5
                },
                sieges: {
                    CGT: 15000,
                    CGT_pourcentage: 22.8
                },
                implantation: {
                    CGT: 25000,
                    CGT_pourcentage: 24.2
                }
            };
            
            // Pourcentage de voix
            updateIndicator(
                'voix-bfc', 
                BFCDataLoader.bfcData.voix.CGT_pourcentage ? BFCDataLoader.bfcData.voix.CGT_pourcentage.toFixed(2) + '%' : 'N/A',
                'voix-national',
                nationalData.voix.CGT_pourcentage.toFixed(2) + '%',
                'voix-diff',
                (BFCDataLoader.bfcData.voix.CGT_pourcentage - nationalData.voix.CGT_pourcentage).toFixed(2) + ' points'
            );
            
            // Nombre de sièges
            updateIndicator(
                'sieges-bfc', 
                BFCDataLoader.bfcData.sieges.CGT ? BFCDataLoader.bfcData.sieges.CGT.toLocaleString() : 'N/A',
                'sieges-national',
                nationalData.sieges.CGT.toLocaleString(),
                'sieges-diff',
                ((BFCDataLoader.bfcData.sieges.CGT_pourcentage - nationalData.sieges.CGT_pourcentage) || 0).toFixed(2) + '%'
            );
            
            // Implantation
            updateIndicator(
                'implantation-bfc', 
                BFCDataLoader.bfcData.implantation.CGT ? BFCDataLoader.bfcData.implantation.CGT.toLocaleString() : 'N/A',
                'implantation-national',
                nationalData.implantation.CGT.toLocaleString(),
                'implantation-diff',
                ((BFCDataLoader.bfcData.implantation.CGT_pourcentage - nationalData.implantation.CGT_pourcentage) || 0).toFixed(2) + '%'
            );
        }
        
        // Fonction pour mettre à jour un indicateur
        function updateIndicator(bfcId, bfcValue, nationalId, nationalValue, diffId, diffValue) {
            const bfcElement = document.getElementById(bfcId);
            const nationalElement = document.getElementById(nationalId);
            const diffElement = document.getElementById(diffId);
            
            if (bfcElement) bfcElement.textContent = bfcValue;
            if (nationalElement) nationalElement.textContent = nationalValue;
            
            if (diffElement) {
                diffElement.textContent = diffValue;
                
                // Ajouter une classe pour indiquer si la différence est positive ou négative
                const numericDiff = parseFloat(diffValue);
                if (numericDiff > 0) {
                    diffElement.classList.add('text-success');
                    diffElement.classList.remove('text-danger');
                    diffElement.innerHTML = '<i class="bi bi-arrow-up-circle"></i> +' + diffValue;
                } else if (numericDiff < 0) {
                    diffElement.classList.add('text-danger');
                    diffElement.classList.remove('text-success');
                    diffElement.innerHTML = '<i class="bi bi-arrow-down-circle"></i> ' + diffValue;
                } else {
                    diffElement.classList.remove('text-success', 'text-danger');
                    diffElement.innerHTML = diffValue;
                }
            }
        }
        
        // Fonction pour créer les graphiques
        function createCharts() {
            console.log('Création des graphiques');
            
            // Données nationales fictives pour la démonstration
            const nationalData = {
                syndicats: {
                    CGT: { pourcentage: 23.5 },
                    CFDT: { pourcentage: 22.4 },
                    FO: { pourcentage: 15.6 },
                    'CFE-CGC': { pourcentage: 10.8 },
                    CFTC: { pourcentage: 9.5 },
                    UNSA: { pourcentage: 8.2 },
                    SUD: { pourcentage: 5.8 }
                }
            };
            
            // Graphique de pourcentage de voix par syndicat
            createVoixChart(nationalData);
            
            // Graphique de répartition des sièges
            createSiegesChart(nationalData);
        }
        
        // Fonction pour créer le graphique de pourcentage de voix
        function createVoixChart(nationalData) {
            const ctx = document.getElementById('voix-chart');
            if (!ctx) return;
            
            // Préparer les données
            const syndicats = ['CGT', 'CFDT', 'FO', 'CFE-CGC', 'CFTC', 'UNSA', 'SUD'];
            const bfcData = [];
            const natData = [];
            
            syndicats.forEach(syndicat => {
                const bfcPct = BFCDataLoader.bfcData.voix[syndicat + '_pourcentage'] || 0;
                const natPct = nationalData.syndicats[syndicat]?.pourcentage || 0;
                
                bfcData.push(bfcPct);
                natData.push(natPct);
            });
            
            // Créer le graphique
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: syndicats,
                    datasets: [
                        {
                            label: 'BFC',
                            data: bfcData,
                            backgroundColor: '#e63946',
                            borderColor: '#e63946',
                            borderWidth: 1
                        },
                        {
                            label: 'National',
                            data: natData,
                            backgroundColor: '#457b9d',
                            borderColor: '#457b9d',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Pourcentage de voix'
                            }
                        }
                    }
                }
            });
        }
        
        // Fonction pour créer le graphique de répartition des sièges
        function createSiegesChart(nationalData) {
            const ctx = document.getElementById('sieges-chart');
            if (!ctx) return;
            
            // Préparer les données
            const syndicats = ['CGT', 'CFDT', 'FO', 'CFE-CGC', 'CFTC', 'UNSA', 'SUD'];
            const bfcData = [];
            const natData = [];
            
            syndicats.forEach(syndicat => {
                const bfcPct = BFCDataLoader.bfcData.sieges[syndicat + '_pourcentage'] || 0;
                const natPct = nationalData.syndicats[syndicat]?.pourcentage || 0;
                
                bfcData.push(bfcPct);
                natData.push(natPct);
            });
            
            // Créer le graphique
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: syndicats,
                    datasets: [
                        {
                            label: 'BFC',
                            data: bfcData,
                            backgroundColor: [
                                '#e63946', // CGT
                                '#457b9d', // CFDT
                                '#f4a261', // FO
                                '#2a9d8f', // CFE-CGC
                                '#6a994e', // CFTC
                                '#9b5de5', // UNSA
                                '#f94144'  // SUD
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Répartition des sièges en BFC'
                        },
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
